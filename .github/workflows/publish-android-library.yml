name: Create Android Release

# This workflow still runs whenever a tag like v1.2.3 is pushed
on:
  push:
    tags:
      - '*.*.*'

jobs:
  build_and_release:
    runs-on: ubuntu-latest
    # No 'packages: write' permission needed anymore
    permissions:
      contents: write # Only needed to create the release page

    steps:
      - name: ⬇️ Checkout Repository
        uses: actions/checkout@v4

      - name: ⚙️ Setup JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: ⚙️ Setup Gradle
        uses: gradle/actions/setup-gradle@v3

      - name: ✅ Verify library builds successfully
        working-directory: ./android
        # This command builds the library to ensure it's not broken
        run: ./gradlew clean :catalyst:build

      - name: ✨ Create GitHub Release Page
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ github.ref_name }}
          name: "Release ${{ github.ref_name }}"
          body: "Official release of the Catalyst, version ${{ github.ref_name }}."